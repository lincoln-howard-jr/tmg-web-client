<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Election/Forum Page</title>
    <script src="assets/javascript/tmg-client.js"></script>


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/uikit.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/css/uikit.min.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>
<body>
    
    <div class = "main">
        <!--Header bar-->
        <header id = "">

            <div class = "col-md-12 container">

                <nav class = "navbar navbar-expanded-lg navbar-dark bg-dark">

                    <div class = "col-md-3">
                        <h2><a class ="navbar-brand bf-dark text-danger" id = "">Metropolitan Global</a></h2>
                    </div>

                    <div class = "col-md-5">
                            <h1><a href = "">Global Congress</a></h1>
                    </div>
                    
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="collapsibleNavbar">
                        <ul class="navbar-nav">
                            <li class="nav-item text-danger">
                                <a href="">Home</a>
                            </li>

                            <li class="nav-item text-danger">
                                <a href="">Profile Page</a>
                            </li>

                            <li class="nav-item text-danger">
                                <a href="">ETC</a>
                            </li>
                            <li class="nav-item">
                                <a href="/signup.html">Sign Up</a>
                            </li>
                        </ul>
                           
                    </div>
                </nav>
            </div>

        </header>
    </div>
    <br>
    <body onload="startTime()">
    <div id="time"></div>
    </body>
    <br>
    <br>
    <!--Proposal Box-->
    <div class = "row" style = "padding: 0px 0px 30px 0px">

        <div class="container col-md-3 " style="background-color:#343a40; height:600px" id="chatty">
            <div class="mx-auto">
                <div class="p-3 mb-2 bg-info text-white">Propasals</div>

                <div class="pre-scrollable" style="height: 900px; background-color: white" id="leaderboard_display">                    
                    <div class="form-group">
                        <ul id="proposal-list">
                    </div>
                </div>         
            </div>
    </div>

    <!--Image-->
    <div class="image col-md-4 " style="background-color:#343a40; height:600px" id="chatty">
        <div class="mx-auto">
            <div class="p-3 mb-2 bg-info text-white">Image</div>
            <img src="assets/images/congress.jpg" class="auth-image" alt="Your Name">
        </div>
</div>

    <!--chat window-->
    <div class="chatty container col-md-4 " style="background-color:#343a40; height:600px" id="chatty">
            <div class="mx-auto">
                <div class="p-3 mb-2 bg-info text-white">Chat Window</div>
                <div class="pre-scrollable" style="height: 900px; background-color: white">
                    <ul id="forum-list">
                    </ul>
                    <div class="add-comment-container">
                        <textarea id="forum-add-comment" class="add-comment"></textarea>
                    </div>
                </div>
            </div>
    </div> 
</div>

<div class = "container col-md-12 bg-dark">
    <div class = "row" id = "bottom" style = "height: 500px">
        <div class = "col-sm">
        
                
                    <div class="col-sm uk-card uk-card-primary uk-card-hover uk-card-body uk-light" >
                        <h3 id="selected-title">Cancer</h3>
                        <p  id="selected-founder">Founder: Sir Reginald Bottomlicker</p>
                        <p id= "selected-likeCount">LikesðŸ’“: 100</p>
                        <p id= "selected-actionPlan">description: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                        <a class="uk-button uk-button-default" href="#modal-overflow" uk-toggle>Comments Section</a>

                        <div id="modal-overflow" uk-modal>
                            <div class="uk-modal-dialog">
                        
                                <button class="uk-modal-close-default" type="button" uk-close></button>
                        
                                <div class="uk-modal-header">
                                    <h2 class="uk-modal-title">Comments</h2>
                                </div>
                        
                                <div class="uk-modal-body" uk-overflow-auto>
                        
                                    <p class = "description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>                     
                                </div>
                        
                                <div class="uk-modal-footer uk-text-right">
                                    <textarea class="uk-textarea" rows="11" placeholder="comments"></textarea>
                                    <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                    <button class="submit uk-button uk-button-primary" type="button">Submit</button>
                                </div>
                        
                            </div>
                        </div>
                    </div>
                
            </div>
                <div class = "col-lg container">
                    <button class="col-sm uk-button uk-button-secondary" id ="yes">Yes</button>
                    <button class="col-sm uk-button uk-button-danger" id ="no">No</button>
                </div>
                <div class="col-sm uk-margin">
                        <textarea class="uk-textarea" rows="11" placeholder="Messages"></textarea>
                        <button id="chat-submit" type="submit" class="btn btn-danger" style="width: 100px; height: 50px">Send</button>
                    </div>
        </div>
        
        </div>  
        
            
            
        
</div>
</div>

<script>
    const _el = (str='div', parent, txt) => {
        let arr = str.split ('.');
        let ret = document.createElement (arr.splice (0, 1) [0]);
        arr.forEach (cn => ret.classList.add (cn));
        if (txt) ret.innerText = txt;
        if (parent) parent.appendChild (ret);
        return ret;
    }
    let forumId = '';
    const commentBox = document.querySelector ('#forum-add-comment');
    commentBox.addEventListener ('keypress', async (e) => {
        try {
            if (e.keyCode !== 13) return;
            let comment = await tmg.createComment ('forums', forumId, commentBox.innerText);
            commentBox.innerText = '';
        } catch (e) {
            alert (e);
        }
    });

    const tmg = TMG ();
    const causeList = document.querySelector ('#proposal-list');
    const forumsList = document.querySelector ('#forum-list');
    (async () => {
        try {
            // selected cause ui
            const keys = 'title actionPlan founder'.split (' ');
            const defaultCause = {title: '', actionPlan: '', founder: '', likeCount: ''};
            const selectedCauseUI = keys.reduce ((acc, val) => {
                acc [val] = document.querySelector (`#selected-${val}`);
                return acc;
            }, {});
            const setSelectedCauseUI = (cause=defaultCause) => {
                keys.forEach (k => selectedCauseUI [k].innerText = cause [k] );
            }
            // setup for elections
            const currElection = await tmg.getElection ();
            const currCauses = await tmg.getCauses ();
            let selectedCause = null;
            let causeUIElements = currCauses.map (cause => {
                //
                cause.founder = `${cause.user.first} ${cause.user.last}`;
                let el = _el('li', causeList);
                let spans = 'title founder'.split (' ').map (cn => _el (`span.${cn}`, el, cause [cn]));
                // add evts
                el.addEventListener ('click', (evt) => {
                    if (selectedCause === cause)
                        selectedCause = defaultCause;
                    else
                        selectedCause = cause;
                    setSelectedCauseUI (selectedCause);
                });
                return el;
            });
            // main elections page
            const forums = await tmg.forums ();
            forums.forEach (forum => {
                forumId = forum._id;
                // create forum container
                let forumContainer = _el ('li.forum-container', forumsList);
                _el ('h3', forumContainer, forum.title);
                _el ('h5', forumContainer, forum.description);
                // comments list
                let commentsList = _el ('ul.comments-list', forumContainer);
                forum.comments.forEach (comment => {
                    let open = false;
                    let commentContainer = _el ('li', commentsList);
                    _el ('span', commentContainer, comment.comment);
                    _el ('span', commentContainer, `${comment.user.first} ${comment.user.last}`);
                    let subCommentsList = _el ('ul.sub-comments-list');
                    commentContainer.addEventListener ('click', async (evt) => {
                        if (open) {
                            commentsList.removeChild (subCommentsList)
                        } else {
                            commentsList.appendChild (subCommentsList);
                            let subComments = await tmg.comments ('comments', comment._id);
                            subComments.forEach (sc => {
                                let subCommentContainer = _el ('li', subCommentsList);
                                _el ('span', subCommentContainer, comment.comment);
                                _el ('span', subCommentContainer, `${comment.user.first} ${comment.user.last}`);
                            });
                        }
                        open = !open;
                    });
                });
                forumContainer.appendChild (commentsList);
            })
        } catch (e) {
            alert (e);
        }
    }) ();
</script>

<script>
    function myFunction(x) {
      x.classList.toggle("fa-thumbs-down");
    }
    </script>

<script src="assets/javascript/time.js"></script>
    <!-- UIkit JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/js/uikit-icons.min.js"></script>
</body>
</html>